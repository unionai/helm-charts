# ============================================================================
# Union Dataplane Configuration for AWS
# ============================================================================
# This file provides a production-ready template for deploying Union dataplane
# on AWS EKS. Replace the placeholder values below with your actual configuration.
#
# For more details, see: https://docs.union.ai/deployment/
# ============================================================================

# Before deployment, replace these placeholders in the globals section below.
# The globals section makes these values accessible to both the chart and
# future subcharts, ensuring consistent configuration across all components.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# SECTION 1: Global Configuration (REQUIRED)
# ----------------------------------------------------------------------------
# These values are accessible to both the chart and all potential subcharts.

global:

  # 1. UNION_CONTROL_PLANE_HOST - Union control plane hostname
  #    Format: "hostname" (no protocol prefix for standard BYOC)
  #    Example: "mycompany.unionai.cloud" or "union.example.com"
  #    Source: Provided by Union team for BYOC deployments
  UNION_CONTROL_PLANE_HOST: ""

  # 2. CLUSTER_NAME - Unique cluster identifier
  #    Format: Lowercase alphanumeric with hyphens
  #    Example: "prod-us-east-1" or "staging-cluster"
  #    Note: Must be unique within your organization
  CLUSTER_NAME: ""

  # 3. ORG_NAME - Organization name
  #    Format: RFC 1123 compliant (lowercase alphanumeric and hyphens)
  #    Example: "acme-corp" or "my-organization"
  #    Source: Provided by Union team
  ORG_NAME: ""

  # 4. CLIENT_ID - Client ID for dataplane authentication
  #    Format: String provided by Union team
  #    Example: "dataplane-prod-client"
  #    Source: Provided by Union team
  CLIENT_ID: ""

  # 5. METADATA_BUCKET - S3 bucket for workflow metadata
  #    Format: Valid S3 bucket name
  #    Example: "my-union-metadata-bucket"
  #    Note: Bucket must exist before deployment
  METADATA_BUCKET: ""

  # 6. S3_FAST_REGISTRATION_BUCKET - S3 bucket for code uploads
  #    Format: Valid S3 bucket name
  #    Example: "my-union-fast-registration-bucket"
  #    Note: Can be same as metadata bucket or separate
  FAST_REGISTRATION_BUCKET: ""

  # 1. AWS_REGION - AWS region for S3 buckets
  #    Format: AWS region code
  #    Example: "us-east-1", "us-west-2", "eu-west-1"
  AWS_REGION: ""

  # 2. BACKEND_IAM_ROLE_ARN - IAM role for Union backend services
  #    Format: Full ARN
  #    Example: "arn:aws:iam::123456789012:role/union-backend-role"
  #    Permissions: S3 access, ECR (if private images)
  BACKEND_IAM_ROLE_ARN: ""

  # 3. WORKER_IAM_ROLE_ARN - IAM role for workflow execution pods
  #    Format: Full ARN
  #    Example: "arn:aws:iam::123456789012:role/union-worker-role"
  #    Permissions: S3 access, AWS services used by workflows
  WORKER_IAM_ROLE_ARN: ""

  # ----------------------------------------------------------------------------
  # Note: For self-hosted intra-cluster deployments (control plane and dataplane
  # in the same cluster), use values.aws.selfhosted-intracluster.yaml instead.
  # That file is self-contained and includes all necessary configuration.
  # ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# SECTION 2: Core Identity Configuration (REQUIRED)
# ----------------------------------------------------------------------------
# These values reference the globals defined above.

# Cloud provider identifier (do not change for AWS)
provider: aws

# ----------------------------------------------------------------------------
# SECTION 3: Object Storage Configuration (REQUIRED)
# ----------------------------------------------------------------------------
# Configure S3 buckets for workflow metadata and fast registration.
# These buckets must be created before deployment.

storage:
  provider: aws
  authType: iam  # Use IAM roles for pods (IRSA recommended)

  # AWS region for S3 buckets
  region: '{{ .Values.global.AWS_REGION }}'
  enableMultiContainer: true

# ----------------------------------------------------------------------------
# SECTION 4: IAM Roles (REQUIRED for AWS)
# ----------------------------------------------------------------------------
# Configure IRSA (IAM Roles for Service Accounts) for secure AWS access.
# These IAM roles must be created with appropriate trust policies and permissions.

# IAM role for Union backend services (operator, propeller, etc.)
additionalServiceAccountAnnotations:
  eks.amazonaws.com/role-arn: "{{ tpl .Values.global.BACKEND_IAM_ROLE_ARN . }}"

# IAM role for workflow execution pods
userRoleAnnotationKey: eks.amazonaws.com/role-arn
userRoleAnnotationValue: "{{ tpl .Values.global.WORKER_IAM_ROLE_ARN . }}"

# ----------------------------------------------------------------------------
# SECTION 5: Authentication Secrets (REQUIRED)
# ----------------------------------------------------------------------------
# Client credentials for authenticating with the Union control plane.
# These will be provided by the Union team for managed control planes.

secrets:
  admin:
    # Client ID for dataplane authentication
    clientId: '{{ .Values.global.CLIENT_ID }}'

    # Client secret for dataplane authentication (keep this secure!)
    clientSecret: ""

    # Whether to create the Kubernetes secret
    # Set to false if you manage secrets externally (e.g., via External Secrets Operator)
    create: true

# ----------------------------------------------------------------------------
# SECTION 6: Logging Configuration (REQUIRED)
# ----------------------------------------------------------------------------
# FluentBit collects and forwards logs to the control plane.

fluentbit:
  serviceAccount:
    name: fluentbit-system
    # Annotations may be required for IRSA
    annotations: {}
