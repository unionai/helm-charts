---
# Source: dataplane/charts/prometheus/charts/kube-state-metrics/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
automountServiceAccountToken: true
metadata:
  labels:    
    helm.sh/chart: kube-state-metrics-7.0.0
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: metrics
    app.kubernetes.io/part-of: kube-state-metrics
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2.17.0"
    release: release-name
  name: release-name-kube-state-metrics
  namespace: union
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: prometheus-operator
  namespace: union
  labels:
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app: prometheus-operator
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator
automountServiceAccountToken: true
---
# Source: dataplane/charts/prometheus/templates/prometheus/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: union-operator-prometheus
  namespace: union
  labels:
    app: prometheus-prometheus
    app.kubernetes.io/name: prometheus-prometheus
    app.kubernetes.io/component: prometheus
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
automountServiceAccountToken: true
---
# Source: dataplane/templates/common/default-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: default
  namespace: union
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/flyte_project_role
automountServiceAccountToken: true
---
# Source: dataplane/templates/nodeexecutor/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: executor
  namespace: union
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: executor
---
# Source: dataplane/templates/operator/serviceaccount-proxy.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: proxy-system
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: operator-proxy
---
# Source: dataplane/templates/operator/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: operator-system
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: union-operator
---
# Source: dataplane/templates/propeller/serviceaccount-webhook.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: flytepropeller-webhook-system
  namespace: union
---
# Source: dataplane/templates/propeller/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: flytepropeller-system
  namespace: union
---
# Source: dataplane/templates/common/auth-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: union-secret-auth
  namespace: union
type: Opaque
data:
  # TODO(rob): update or configure operator to use client_secret like all the other components.
  app_secret: bXktc2VjcmV0
  client_secret: bXktc2VjcmV0
---
# Source: dataplane/templates/common/cluster-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: operator-cluster-name
type: Opaque
data:
  cluster_name: bXktY2x1c3Rlcg==
---
# Source: dataplane/templates/propeller/deployment-webhook.yaml
# Create an empty secret that the first propeller pod will populate
apiVersion: v1
kind: Secret
metadata:
  name: flyte-pod-webhook
  namespace: union
type: Opaque
---
# Source: dataplane/templates/nodeexecutor/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: executor
  namespace: union
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: executor
data:
  task_logs.yaml: | 
    plugins:
      logs:
        cloudwatch-enabled: false
        kubernetes-enabled: true
  enabled_plugins.yaml: |
    tasks:
      task-plugins:
        default-for-task-types:
          actor: fast-task
          container: container
          container_array: k8s-array
          sidecar: sidecar
        enabled-plugins:
        - container
        - sidecar
        - k8s-array
        - agent-service
        - echo
        - fast-task
  config.yaml: |
    executor:
      cluster: 'my-cluster'
      evaluatorCount: 64
      maxActions: 2000
      organization: 'union'
      unionAuth:
        injectSecret: true
        secretName: EAGER_API_KEY
      workerName: worker1
      task_resources:
        defaults:
          cpu: 100m
          memory: 500Mi
        limits:
          cpu: 4096
          gpu: 256
          memory: 2Ti
    namespace_mapping:
      template: 'union'
    union:
      connection:
        host: dns:///union.us-west-2.union.ai
      auth:
        authorizationMetadataKey: flyte-authorization
        clientId: 'my-client-id'
        clientSecretLocation: /etc/union/secret/client_secret
        tokenRefreshWindow: 5m
        type: ClientSecret
    admin:
      clientId: 'my-client-id'
      clientSecretLocation: /etc/union/secret/client_secret
      endpoint: dns:///union.us-west-2.union.ai
      insecure: false
    authorizer:
      type: noop
    catalog-cache:
      cache-endpoint: dns:///union.us-west-2.union.ai
      endpoint: dns:///union.us-west-2.union.ai
      insecure: false
      type: fallback
      use-admin-auth: true
    logger:
      level: 4
      show-source: true
    namespace_mapping:
      template: 'union'
    sharedService:
      metrics:
        scope: 'executor:'
      security:
        allowCors: true
        allowLocalhostAccess: true
        allowedHeaders:
        - Content-Type
        allowedOrigins:
        - '*'
        secure: false
        useAuth: false
    propeller:
      limit-namespace: 'union'
      node-config:
        disable-input-file-writes: true
    plugins:
      fasttask:
        additional-worker-args:
        - --last-ack-grace-period-seconds
        - "120"
        callback-uri: http://unionai-dataplane-executor.union.svc.cluster.local:15605
        grace-period-status-not-found: 2m
      ioutils:
        remoteFileOutputPaths:
          deckFilename: report.html
      k8s:
        disable-inject-owner-references: true
        default-cpus: 100m
        default-env-vars:
        - FLYTE_AWS_ENDPOINT: http://localstack.aws.svc.cluster.local:4566
        - FLYTE_AWS_ACCESS_KEY_ID: test123
        - FLYTE_AWS_SECRET_ACCESS_KEY: test
        default-memory: 100Mi
        co-pilot:
          image: 'cr.flyte.org/flyteorg/flytecopilot:v1.14.1'
          name: flyte-copilot-
          start-timeout: 30s
    storage:
      container: "bucket"
      type: stow
      stow:
        kind: s3
        config:
          auth_type: accesskey
          access_key_id: test123
          secret_key: test
          disable_ssl: false
          endpoint: http://localstack.aws.svc.cluster.local:4566
          region: us-west-2
      enable-multicontainer: false
      limits:
        maxDownloadMBs: 1024
      cache:
        max_size_mbs: 0
        target_gc_percent: 70
---
# Source: dataplane/templates/operator/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: union-operator
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: union-operator
data:
  k8s.yaml: | 
    plugins:
      k8s:
        default-cpus: 100m
        default-env-vars:
        - FLYTE_AWS_ENDPOINT: http://localstack.aws.svc.cluster.local:4566
        - FLYTE_AWS_ACCESS_KEY_ID: test123
        - FLYTE_AWS_SECRET_ACCESS_KEY: test
        default-memory: 100Mi
  config.yaml: |
    union:
      connection:
        host: dns:///union.us-west-2.union.ai
      auth:
        authorizationMetadataKey: flyte-authorization
        clientId: 'my-client-id'
        clientSecretLocation: /etc/union/secret/client_secret
        tokenRefreshWindow: 5m
        type: ClientSecret
    sharedService:
      features:
        gatewayV2: true
      port: 8081
    authorizer:
      type: noop
    operator:
      enabled: true
      enableTunnelService: true
      tunnel:
        enableDirectToAppIngress: false
        deploymentToRestart: union-operator-proxy
      limitNamespace: 'union'
      disableClusterPermissions: true
      apps:
        enabled: 'false'
      syncClusterConfig:
        enabled: false
      clusterId:
        organization: 'union'
      clusterData:
        appId: 'my-client-id'
        bucketName: 'bucket'
        bucketRegion: 'us-west-2'
        cloudHostName: 'union.us-west-2.union.ai'
        gcpProjectId: ''
        metadataBucketPrefix: 's3://bucket'
        userRole: 'arn:aws:iam::ACCOUNT_ID:role/flyte_project_role'
        userRoleKey: 'eks.amazonaws.com/role-arn'
      collectUsages:
        enabled: false
      billableUsageCollector:
        enabled: false
      dependenciesHeartbeat:
        propeller:
          endpoint: 'http://flytepropeller:10254'
        proxy:
          endpoint: 'http://union-operator-proxy:10254'
    proxy:
      imageBuilderConfig:
        authenticationType: 'noop'
        defaultRepository: ''
      persistedLogs:
        objectStore:
          pathTemplate: namespace-{{.KubernetesNamespace}}.pod-{{.KubernetesPodName}}.cont-{{.KubernetesContainerName}}
          prefix: persisted-logs
        sourceType: ObjectStore
      smConfig:
        enabled: 'true'
        k8sConfig:
          namespace: 'union'
        type: 'K8s'
  logger.yaml: |
    logger:
      level: 4
      show-source: true
  config-overrides.yaml: | 
    cache:
      identity:
        enabled: false
  storage.yaml: | 
    storage:
      container: "bucket"
      type: stow
      stow:
        kind: s3
        config:
          auth_type: accesskey
          access_key_id: test123
          secret_key: test
          disable_ssl: false
          endpoint: http://localstack.aws.svc.cluster.local:4566
          region: us-west-2
      enable-multicontainer: false
      limits:
        maxDownloadMBs: 1024
      cache:
        max_size_mbs: 0
        target_gc_percent: 70
  fast_registration_storage.yaml: | 
    fastRegistrationStorage:
      container: "bucket"
      type: stow
      stow:
        kind: s3
        config:
          auth_type: accesskey
          access_key_id: test123
          secret_key: test
          disable_ssl: false
          endpoint: http://localstack.aws.svc.cluster.local:4566
          region: us-west-2
---
# Source: dataplane/templates/propeller/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: flyte-propeller-config
  namespace: union
data:
  admin.yaml: | 
    admin:
      clientId: 'my-client-id'
      clientSecretLocation: /etc/union/secret/client_secret
      endpoint: dns:///union.us-west-2.union.ai
      insecure: false
    event:
      capacity: 1000
      rate: 500
      type: admin
  catalog.yaml: | 
    catalog-cache:
      cache-endpoint: dns:///union.us-west-2.union.ai
      endpoint: dns:///union.us-west-2.union.ai
      insecure: false
      type: fallback
      use-admin-auth: true
  copilot.yaml: | 
    plugins:
      k8s:
        co-pilot:
          image: 'cr.flyte.org/flyteorg/flytecopilot:v1.14.1'
          name: flyte-copilot-
          start-timeout: 30s
  core.yaml: | 
    propeller:
      downstream-eval-duration: 30s
      enable-admin-launcher: true
      leader-election:
        enabled: true
        lease-duration: 15s
        lock-config-map:
          name: propeller-leader
          namespace: 'union'
        renew-deadline: 10s
        retry-period: 2s
      limit-namespace: 'union'
      literal-offloading-config:
        enabled: true
      max-workflow-retries: 30
      metadata-prefix: metadata/propeller
      metrics-prefix: flyte
      prof-port: 10254
      queue:
        batch-size: -1
        batching-interval: 2s
        queue:
          base-delay: 5s
          capacity: 1000
          max-delay: 120s
          rate: 100
          type: maxof
        sub-queue:
          capacity: 100
          rate: 10
          type: bucket
        type: batch
      rawoutput-prefix: 's3://bucket'
      workers: 4
      workflow-reeval-duration: 30s
    webhook:
      certDir: /etc/webhook/certs
      disableCreateMutatingWebhookConfig: true
      embeddedSecretManagerConfig:
        imagePullSecrets:
          enabled: true
        k8sConfig:
          namespace: 'union'
        type: 'K8s'
      listenPort: '9443'
      secretManagerTypes:
      - Embedded
      - K8s
      serviceName: flyte-pod-webhook
      servicePort: '443'
  enabled_plugins.yaml: | 
    tasks:
      task-plugins:
        default-for-task-types:
          actor: fast-task
          container: container
          container_array: k8s-array
          sidecar: sidecar
        enabled-plugins:
        - container
        - sidecar
        - k8s-array
        - agent-service
        - echo
        - fast-task
  k8s.yaml: | 
    plugins:
      k8s:
        default-cpus: 100m
        default-env-vars:
        - FLYTE_AWS_ENDPOINT: http://localstack.aws.svc.cluster.local:4566
        - FLYTE_AWS_ACCESS_KEY_ID: test123
        - FLYTE_AWS_SECRET_ACCESS_KEY: test
        default-memory: 100Mi
  logger.yaml: |
    logger:
      level: 4
      show-source: true
  namespace_config.yaml: | 
    namespace_mapping:
      template: 'union'
  resource_manager.yaml: | 
    propeller:
      resourcemanager:
        type: noop
  task_logs.yaml: | 
    plugins:
      logs:
        cloudwatch-enabled: false
        dynamic-log-links:
        - vscode:
            displayName: VS Code Debugger
            templateUris:
            - /dataplane/pod/v1/generated_name/task/{{.executionProject}}/{{.executionDomain}}/{{.executionName}}/{{.nodeID}}/{{.taskRetryAttempt}}/{{.taskProject}}/{{.taskDomain}}/{{.taskID}}/{{.taskVersion}}/
        kubernetes-enabled: false
        templates:
        - displayName: Task Logs
          scheme: TaskExecution
          templateUris:
          - /console/projects/{{.executionProject}}/domains/{{.executionDomain}}/executions/{{.executionName}}/nodeId/{{.nodeID}}/taskId/{{.taskID}}/attempt/{{.taskRetryAttempt}}/view/logs?duration=all&fromExecutionNav=true
  storage.yaml: | 
    storage:
      container: "bucket"
      type: stow
      stow:
        kind: s3
        config:
          auth_type: accesskey
          access_key_id: test123
          secret_key: test
          disable_ssl: false
          endpoint: http://localstack.aws.svc.cluster.local:4566
          region: us-west-2
      enable-multicontainer: false
      limits:
        maxDownloadMBs: 1024
      cache:
        max_size_mbs: 0
        target_gc_percent: 70
---
# Source: dataplane/charts/prometheus/charts/kube-state-metrics/templates/role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:    
    helm.sh/chart: kube-state-metrics-7.0.0
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: metrics
    app.kubernetes.io/part-of: kube-state-metrics
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2.17.0"
    release: release-name
  name: release-name-kube-state-metrics
rules:

- apiGroups: ["certificates.k8s.io"]
  resources:
  - certificatesigningrequests
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - configmaps
  verbs: ["list", "watch"]

- apiGroups: ["batch"]
  resources:
  - cronjobs
  verbs: ["list", "watch"]

- apiGroups: ["apps"]
  resources:
  - daemonsets
  verbs: ["list", "watch"]

- apiGroups: ["apps"]
  resources:
  - deployments
  verbs: ["list", "watch"]

- apiGroups: ["discovery.k8s.io"]
  resources:
  - endpointslices
  verbs: ["list", "watch"]

- apiGroups: ["autoscaling"]
  resources:
  - horizontalpodautoscalers
  verbs: ["list", "watch"]

- apiGroups: ["networking.k8s.io"]
  resources:
  - ingresses
  verbs: ["list", "watch"]

- apiGroups: ["batch"]
  resources:
  - jobs
  verbs: ["list", "watch"]

- apiGroups: ["coordination.k8s.io"]
  resources:
  - leases
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - limitranges
  verbs: ["list", "watch"]

- apiGroups: ["admissionregistration.k8s.io"]
  resources:
    - mutatingwebhookconfigurations
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - namespaces
  verbs: ["list", "watch"]

- apiGroups: ["networking.k8s.io"]
  resources:
  - networkpolicies
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - nodes
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - persistentvolumeclaims
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - persistentvolumes
  verbs: ["list", "watch"]

- apiGroups: ["policy"]
  resources:
    - poddisruptionbudgets
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - pods
  verbs: ["list", "watch"]

- apiGroups: ["apps"]
  resources:
  - replicasets
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - replicationcontrollers
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - resourcequotas
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - secrets
  verbs: ["list", "watch"]

- apiGroups: [""]
  resources:
  - services
  verbs: ["list", "watch"]

- apiGroups: ["apps"]
  resources:
  - statefulsets
  verbs: ["list", "watch"]

- apiGroups: ["storage.k8s.io"]
  resources:
    - storageclasses
  verbs: ["list", "watch"]

- apiGroups: ["admissionregistration.k8s.io"]
  resources:
    - validatingwebhookconfigurations
  verbs: ["list", "watch"]

- apiGroups: ["storage.k8s.io"]
  resources:
    - volumeattachments
  verbs: ["list", "watch"]
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/clusterrole.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: prometheus-operator
  labels:
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app: prometheus-operator
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator
rules:
- apiGroups:
  - monitoring.coreos.com
  resources:
  - alertmanagers
  - alertmanagers/finalizers
  - alertmanagers/status
  - alertmanagerconfigs
  - prometheuses
  - prometheuses/finalizers
  - prometheuses/status
  - prometheusagents
  - prometheusagents/finalizers
  - prometheusagents/status
  - thanosrulers
  - thanosrulers/finalizers
  - thanosrulers/status
  - scrapeconfigs
  - scrapeconfigs/status
  - servicemonitors
  - servicemonitors/status
  - podmonitors
  - podmonitors/status
  - probes
  - probes/status
  - prometheusrules
  - prometheusrules/status
  verbs:
  - '*'
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - '*'
- apiGroups:
  - ""
  resources:
  - configmaps
  - secrets
  verbs:
  - '*'
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - list
  - delete
- apiGroups:
  - ""
  resources:
  - services
  - services/finalizers
  - endpoints
  verbs:
  - get
  - create
  - update
  - delete
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - namespaces
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  - events.k8s.io
  resources:
  - events
  verbs:
  - patch
  - create
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  verbs:
  - get
- apiGroups:
  - discovery.k8s.io
  resources:
  - endpointslices
  verbs:
  - get
  - create
  - list
  - watch
  - update
  - delete
---
# Source: dataplane/charts/prometheus/templates/prometheus/clusterrole.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: union-operator-prometheus
  labels:
    app: prometheus-prometheus
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
rules:
# These permissions (to examine all namespaces) are not in the kube-prometheus repo.
# They're grabbed from https://github.com/prometheus/prometheus/blob/master/documentation/examples/rbac-setup.yml
# kube-prometheus deliberately defaults to a more restrictive setup that is not appropriate for our general audience.
- apiGroups: [""]
  resources:
  - nodes
  - nodes/metrics
  - services
  - endpoints
  - pods
  verbs: ["get", "list", "watch"]
- apiGroups: ["discovery.k8s.io"]
  resources:
  - endpointslices
  verbs: ["get", "list", "watch"]
- apiGroups:
  - "networking.k8s.io"
  resources:
  - ingresses
  verbs: ["get", "list", "watch"]
- nonResourceURLs: ["/metrics", "/metrics/cadvisor"]
  verbs: ["get"]
---
# Source: dataplane/charts/prometheus/charts/kube-state-metrics/templates/clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:    
    helm.sh/chart: kube-state-metrics-7.0.0
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: metrics
    app.kubernetes.io/part-of: kube-state-metrics
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2.17.0"
    release: release-name
  name: release-name-kube-state-metrics
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: release-name-kube-state-metrics
subjects:
- kind: ServiceAccount
  name: release-name-kube-state-metrics
  namespace: union
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: prometheus-operator
  labels:
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app: prometheus-operator
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: prometheus-operator
subjects:
- kind: ServiceAccount
  name: prometheus-operator
  namespace: union
---
# Source: dataplane/charts/prometheus/templates/prometheus/clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: union-operator-prometheus
  labels:
    app: prometheus-prometheus
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: union-operator-prometheus
subjects:
  - kind: ServiceAccount
    name: union-operator-prometheus
    namespace: union
---
# Source: dataplane/templates/operator/serviceaccount-proxy-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: proxy-system-secret
  namespace: union
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: operator-proxy
rules:
  - apiGroups:
      - '*'
    resources:
      - secrets
    verbs:
      - get
      - list
      - create
      - update
      - delete
---
# Source: dataplane/templates/operator/serviceaccount-proxy.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: proxy-system
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: operator-proxy
rules:
  - apiGroups:
      - '*'
    resources:
      - events
      - flyteworkflows
      - pods/log
      - pods
      - rayjobs
      - resourcequotas
    verbs:
      - get
      - list
      - watch
---
# Source: dataplane/templates/operator/serviceaccount.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: operator-system
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: union-operator
rules:
  - apiGroups:
      - '*'
    resources:
      - secrets
      - deployments
    verbs:
      - get
      - list
      - watch
      - create
      - update
  - apiGroups:
      - flyte.lyft.com
    resources:
      - flyteworkflows
      - flyteworkflows/finalizers
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - delete
      - patch
      - post
      - deletecollection
  - apiGroups:
      - '*'
    resources:
      - resourcequotas
      - pods
      - configmaps
      - podtemplates
      - secrets
      - namespaces
      - nodes
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - delete
---
# Source: dataplane/templates/propeller/serviceaccount-webhook.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: flytepropeller-webhook-role
  namespace: union
rules:
  - apiGroups:
      - "*"
    resources:
      - mutatingwebhookconfigurations
      - secrets
      - pods
      - replicasets/finalizers
    verbs:
      - get
      - create
      - update
      - patch
---
# Source: dataplane/templates/propeller/serviceaccount.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: flytepropeller-role
rules:
  # Allow RO access to PODS
  - apiGroups:
      - ""
    resources:
      - pods
    verbs:
      - get
      - list
      - watch
  # Allow Event recording access
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - create
      - update
      - delete
      - patch
  # Allow Access All plugin objects
  - apiGroups:
      - '*'
    resources:
      - '*'
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - delete
      - patch
  # Allow Access to CRD
  - apiGroups:
      - apiextensions.k8s.io
    resources:
      - customresourcedefinitions
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - update
  # Allow Access to all resources under flyte.lyft.com
  - apiGroups:
      - flyte.lyft.com
    resources:
      - flyteworkflows
      - flyteworkflows/finalizers
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - delete
      - patch
      - post
      - deletecollection
---
# Source: dataplane/templates/operator/serviceaccount-proxy-secret.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: proxy-system-secret
  namespace: union
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: operator-proxy
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: proxy-system-secret
subjects:
  - kind: ServiceAccount
    name: proxy-system
    namespace: union
---
# Source: dataplane/templates/operator/serviceaccount-proxy.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: proxy-system
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: operator-proxy
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: proxy-system
subjects:
  - kind: ServiceAccount
    name: proxy-system
    namespace: union
---
# Source: dataplane/templates/operator/serviceaccount.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: operator-system
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: union-operator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: operator-system
subjects:
  - kind: ServiceAccount
    name: operator-system
    namespace: union
---
# Source: dataplane/templates/propeller/serviceaccount-webhook.yaml
# Create a binding from Role -> ServiceAccount
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: flytepropeller-webhook-binding
  namespace: union
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: flytepropeller-webhook-role
subjects:
  - kind: ServiceAccount
    name: flytepropeller-webhook-system
    namespace: union
---
# Source: dataplane/templates/propeller/serviceaccount.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: flytepropeller-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: flytepropeller-role
subjects:
  - kind: ServiceAccount
    name: flytepropeller-system
    namespace: union
---
# Source: dataplane/charts/prometheus/charts/kube-state-metrics/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: release-name-kube-state-metrics
  namespace: union
  labels:    
    helm.sh/chart: kube-state-metrics-7.0.0
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: metrics
    app.kubernetes.io/part-of: kube-state-metrics
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2.17.0"
    release: release-name
  annotations:
spec:
  type: "ClusterIP"
  ports:
  - name: http
    protocol: TCP
    port: 8080
    targetPort: http
  
  selector:    
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/instance: release-name
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: prometheus-operator
  namespace: union
  labels:
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app: prometheus-operator
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator
spec:
  ports:
  - name: https
    port: 443
    targetPort: https
  selector:
    app: prometheus-operator
    release: "release-name"
  type: "ClusterIP"
---
# Source: dataplane/charts/prometheus/templates/prometheus/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: union-operator-prometheus
  namespace: union
  labels:
    app: prometheus-prometheus
    self-monitor: "true"
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
spec:
  ports:
  - name: http-web
    port: 80
    targetPort: 9090
  - name: reloader-web
    appProtocol: http
    port: 8080
    targetPort: reloader-web
  publishNotReadyAddresses: false
  selector:
    app.kubernetes.io/name: prometheus
    operator.prometheus.io/name: union-operator-prometheus
  sessionAffinity: None
  type: "ClusterIP"
---
# Source: dataplane/templates/clusterresourcesync/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: syncresources
  labels:
    platform.union.ai/prometheus-group: "union-services"
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: clusterresourcesync
spec:
  type: ClusterIP
  ports:
    - port: 10254
      targetPort: debug
      protocol: TCP
      name: debug
  selector:
      app.kubernetes.io/name: release-name-dataplane
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: clusterresourcesync
---
# Source: dataplane/templates/nodeexecutor/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: release-name-dataplane-executor
  labels:
    platform.union.ai/prometheus-group: "union-services"
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: executor
spec:
  type: ClusterIP
  ports:
    - port: 15605
      targetPort: 15605
      protocol: TCP
      name: fasttask
    - port: 10254
      targetPort: debug
      protocol: TCP
      name: debug
  selector:
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: executor
---
# Source: dataplane/templates/operator/service-proxy.yaml
apiVersion: v1
kind: Service
metadata:
  name: union-operator-proxy
  labels:
    platform.union.ai/prometheus-group: "union-services"
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: operator-proxy
spec:
  type: ClusterIP
  ports:
    - port: 8080
      targetPort: http
      protocol: TCP
      name: http
    - port: 10254
      targetPort: debug
      protocol: TCP
      name: debug
  selector:
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: operator-proxy
---
# Source: dataplane/templates/operator/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: union-operator
  labels:
    platform.union.ai/prometheus-group: "union-services"
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: union-operator
spec:
  type: ClusterIP
  ports:
    - port: 10254
      targetPort: debug
      protocol: TCP
      name: debug
  selector:
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: union-operator
---
# Source: dataplane/templates/propeller/service-webhook.yaml
apiVersion: v1
kind: Service
metadata:
  name: flyte-pod-webhook
  namespace: union
  labels:
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: flyte-pod-webhook
  annotations:
    projectcontour.io/upstream-protocol.h2c: grpc
spec:
  selector:
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: flyte-pod-webhook
  ports:
    - name: https
      protocol: TCP
      port: 443
      targetPort: 9443
    - name: debug
      protocol: TCP
      port: 10254
      targetPort: 10254
---
# Source: dataplane/templates/propeller/service.yaml
apiVersion: v1
kind: Service
metadata:
  namespace: union
  name: flytepropeller
  labels:
    platform.union.ai/prometheus-group: "union-services"
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: flytepropeller
spec:
  type: ClusterIP
  ports:
    - name: debug
      protocol: TCP
      port: 10254
    - name: fasttask
      port: 15605
      protocol: TCP
      targetPort: 15605
  selector:
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: flytepropeller
---
# Source: dataplane/charts/prometheus/charts/kube-state-metrics/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-kube-state-metrics
  namespace: union
  labels:    
    helm.sh/chart: kube-state-metrics-7.0.0
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: metrics
    app.kubernetes.io/part-of: kube-state-metrics
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2.17.0"
    release: release-name
spec:
  selector:
    matchLabels:      
      app.kubernetes.io/name: kube-state-metrics
      app.kubernetes.io/instance: release-name
  replicas: 1
  strategy:
    type: RollingUpdate
  revisionHistoryLimit: 10
  template:
    metadata:
      labels:        
        helm.sh/chart: kube-state-metrics-7.0.0
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: metrics
        app.kubernetes.io/part-of: kube-state-metrics
        app.kubernetes.io/name: kube-state-metrics
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/version: "2.17.0"
        release: release-name
    spec:
      automountServiceAccountToken: true
      hostNetwork: false
      serviceAccountName: release-name-kube-state-metrics
      securityContext:
        fsGroup: 65534
        runAsGroup: 65534
        runAsNonRoot: true
        runAsUser: 65534
        seccompProfile:
          type: RuntimeDefault
      dnsPolicy: ClusterFirst
      containers:
      - name: kube-state-metrics
        args:
        - --port=8080
        - --resources=certificatesigningrequests,configmaps,cronjobs,daemonsets,deployments,endpointslices,horizontalpodautoscalers,ingresses,jobs,leases,limitranges,mutatingwebhookconfigurations,namespaces,networkpolicies,nodes,persistentvolumeclaims,persistentvolumes,poddisruptionbudgets,pods,replicasets,replicationcontrollers,resourcequotas,secrets,services,statefulsets,storageclasses,validatingwebhookconfigurations,volumeattachments
        imagePullPolicy: IfNotPresent
        image: registry.k8s.io/kube-state-metrics/kube-state-metrics:v2.17.0
        ports:
        - containerPort: 8080
          name: http
        livenessProbe:
          failureThreshold: 3
          httpGet:
            httpHeaders:
            path: /livez
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        readinessProbe:
          failureThreshold: 3
          httpGet:
            httpHeaders:
            path: /readyz
            port: 8081
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          {}
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus-operator
  namespace: union
  labels:
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app: prometheus-operator
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: prometheus-operator
      release: "release-name"
  template:
    metadata:
      labels:
        
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/version: "80.8.0"
        app.kubernetes.io/part-of: prometheus
        chart: prometheus-80.8.0
        release: "release-name"
        heritage: "Helm"
        platform.union.ai/prometheus-group: union-features
        app: prometheus-operator
        app.kubernetes.io/name: prometheus-prometheus-operator
        app.kubernetes.io/component: prometheus-operator
    spec:
      containers:
        - name: prometheus
          image: "quay.io/prometheus-operator/prometheus-operator:v0.87.1"
          imagePullPolicy: "IfNotPresent"
          args:
            - --kubelet-service=kube-system/union-operator-kubelet
            - --kubelet-endpoints=true
            - --kubelet-endpointslice=false
            - --localhost=127.0.0.1
            - --prometheus-config-reloader=quay.io/prometheus-operator/prometheus-config-reloader:v0.87.1
            - --config-reloader-cpu-request=0
            - --config-reloader-cpu-limit=0
            - --config-reloader-memory-request=0
            - --config-reloader-memory-limit=0
            - --thanos-default-base-image=quay.io/thanos/thanos:v0.40.1
            - --secret-field-selector=type!=kubernetes.io/dockercfg,type!=kubernetes.io/service-account-token,type!=helm.sh/release.v1
            - --web.enable-tls=true
            - --web.cert-file=/cert/cert
            - --web.key-file=/cert/key
            - --web.listen-address=:10250
            - --web.tls-min-version=VersionTLS13
          ports:
            - containerPort: 10250
              name: https
          env:
          - name: GOGC
            value: "30"
          resources:
            {}
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
          volumeMounts:
            - name: tls-secret
              mountPath: /cert
              readOnly: true
          readinessProbe:
            httpGet:
              path: /healthz
              port: https
              scheme: HTTPS
            initialDelaySeconds: 0
            periodSeconds: 10
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 3
          livenessProbe:
            httpGet:
              path: /healthz
              port: https
              scheme: HTTPS
            initialDelaySeconds: 0
            periodSeconds: 10
            timeoutSeconds: 1
            successThreshold: 1
            failureThreshold: 3
      volumes:
        - name: tls-secret
          secret:
            defaultMode: 420
            secretName: union-operator-admission
      securityContext:
        fsGroup: 65534
        runAsGroup: 65534
        runAsNonRoot: true
        runAsUser: 65534
        seccompProfile:
          type: RuntimeDefault
      serviceAccountName: prometheus-operator
      automountServiceAccountToken: true
      terminationGracePeriodSeconds: 30
---
# Source: dataplane/templates/nodeexecutor/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: executor
  namespace: union
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: executor
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: release-name-dataplane
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: executor
  template:
    metadata:
      annotations:
        configChecksum: "3c0cc02fdd90eeba9418af9ea8baeedde76ba97b911f68717ec91c726da8bc7"
      labels:
        
        app: executor
        app.kubernetes.io/component: executor
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: release-name-dataplane
        app.kubernetes.io/version: 2026.1.1
        helm.sh/chart: dataplane-2026.1.1
    spec:
      securityContext:
        fsGroup: 1337
      serviceAccountName: flytepropeller-system # TODO: update `executor` ServiceAccount to have required permissions
      volumes:
        - name: config-volume
          configMap:
            name: executor
        - name: secret-volume
          secret:
            secretName: union-secret-auth
        - name: auth
          secret:
            secretName: union-secret-auth
      containers:
        - name: executor
          image: "public.ecr.aws/p0i0a9q8/unionoperator:2026.1.1"
          imagePullPolicy: IfNotPresent
          command:
            - executor
            - serve
            - --config
            - /etc/config/*.yaml
          ports:
            - name: http
              containerPort: 8089
              protocol: TCP
            - name: debug
              containerPort: 10254
              protocol: TCP
          env:
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: GOMEMLIMIT
              valueFrom:
                resourceFieldRef:
                  divisor: 1
                  resource: limits.memory
            - name: GOMAXPROCS
              valueFrom:
                resourceFieldRef:
                  divisor: 1
                  resource: limits.cpu
            - name: CLUSTER_NAME
              valueFrom:
                secretKeyRef:
                  name: operator-cluster-name
                  key: cluster_name
            - name: DEPLOYMENT_NAME
              value: operator
            - name: PROXY_SERVICE_URL
              value: http://union-operator-proxy:8080
            - name: PROMETHEUS_SERVICE_URL
              value: http://union-operator-prometheus:80
            - name: KNATIVE_PROXY_SERVICE_URL
              value: http://kourier-internal
          resources:
            limits:
              cpu:    "4"
              memory: "8Gi"
            requests:
              cpu:    "1"
              memory: "1Gi"
          volumeMounts:
            - name: config-volume
              mountPath: /etc/config
            - name: secret-volume
              mountPath: /etc/union/secret
            - name: auth
              mountPath: /etc/secrets/
---
# Source: dataplane/templates/operator/deployment-proxy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: union-operator-proxy
  namespace: union
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: operator-proxy
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: release-name-dataplane
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: operator-proxy
  template:
    metadata:
      annotations:
        configChecksum: "6dd8499ccc95cc5133d0224d8478b81c22ed75f60b846d10f75334aa755f0d0"
        
      labels:
        
        helm.sh/chart: dataplane-2026.1.1
        app.kubernetes.io/name: release-name-dataplane
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/version: "2026.1.1"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: operator-proxy
    spec:
      volumes:
        - name: config-volume
          projected:
            sources:
            - configMap:
                name: union-operator
        - name: secret-volume
          secret:
            secretName: union-secret-auth
      serviceAccountName: proxy-system
      securityContext:
        {}
      containers:
        - name: operator-proxy
          securityContext:
            {}
          image: "public.ecr.aws/p0i0a9q8/unionoperator:2026.1.1"
          imagePullPolicy: IfNotPresent
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: "3"
              memory: 3Gi
            requests:
              cpu: 500m
              memory: 500Mi
          volumeMounts:
            - mountPath: /etc/union/config
              name: config-volume
            - mountPath: /etc/union/secret
              name: secret-volume
          args:
            - operator
            - proxy
            - --config
            - /etc/union/config/*.yaml
          ports:
            - name: http
              containerPort: 8089
              protocol: TCP
            - name: connect
              containerPort: 8080
              protocol: TCP
            - name: grpc
              containerPort: 8081
              protocol: TCP
            - name: debug
              containerPort: 10254
              protocol: TCP
          env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: GOMEMLIMIT
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.memory
          - name: GOMAXPROCS
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.cpu
          - name: CLUSTER_NAME
            valueFrom:
              secretKeyRef:
                name: operator-cluster-name
                key: cluster_name
          - name: DEPLOYMENT_NAME
            value: operator
          - name: PROXY_SERVICE_URL
            value: http://union-operator-proxy:8080
          - name: PROMETHEUS_SERVICE_URL
            value: http://union-operator-prometheus:80
          - name: KNATIVE_PROXY_SERVICE_URL
            value: http://kourier-internal
        - name: "tunnel"
          securityContext:
            {}
          image: "public.ecr.aws/p0i0a9q8/unionoperator:2026.1.1"
          imagePullPolicy: IfNotPresent
          args:
            - cloudflared
            - tunnel
            - --no-autoupdate
            - run
            - --token
            - $(TUNNEL_TOKEN)
          env:
            - name: TUNNEL_TOKEN
              valueFrom:
                secretKeyRef:
                  name: union-secret-auth
                  key: tunnel_token
                  optional: true
          resources:
            limits:
              cpu: "3"
              memory: 3Gi
            requests:
              cpu: 500m
              memory: 500Mi
---
# Source: dataplane/templates/operator/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: union-operator
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: union-operator
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: release-name-dataplane
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: union-operator
  template:
    metadata:
      annotations:
        configChecksum: "6dd8499ccc95cc5133d0224d8478b81c22ed75f60b846d10f75334aa755f0d0"
        
      labels:
        
        helm.sh/chart: dataplane-2026.1.1
        app.kubernetes.io/name: release-name-dataplane
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/version: "2026.1.1"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: union-operator
    spec:
      serviceAccountName: operator-system
      securityContext:
        {}
      volumes:
        - name: config-volume
          configMap:
            name: union-operator
        - name: secret-volume
          secret:
            secretName: union-secret-auth
      containers:
        - name: operator
          securityContext:
            {}
          image: "public.ecr.aws/p0i0a9q8/unionoperator:2026.1.1"
          imagePullPolicy: IfNotPresent
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: "2"
              memory: 3Gi
            requests:
              cpu: "1"
              memory: 1Gi
          volumeMounts:
            - mountPath: /etc/union/config
              name: config-volume
            - mountPath: /etc/union/secret
              name: secret-volume
          env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: GOMEMLIMIT
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.memory
          - name: GOMAXPROCS
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.cpu
          - name: CLUSTER_NAME
            valueFrom:
              secretKeyRef:
                name: operator-cluster-name
                key: cluster_name
          - name: DEPLOYMENT_NAME
            value: operator
          - name: PROXY_SERVICE_URL
            value: http://union-operator-proxy:8080
          - name: PROMETHEUS_SERVICE_URL
            value: http://union-operator-prometheus:80
          - name: KNATIVE_PROXY_SERVICE_URL
            value: http://kourier-internal
          args:
            - operator
            - serve
            - --config
            - /etc/union/config/*.yaml
            - --operator.clusterId.name
            - "$(CLUSTER_NAME)"
            - --operator.tunnel.k8sSecretName
            - union-secret-auth
          ports:
            - name: grpc
              containerPort: 8080
              protocol: TCP
            - name: http
              containerPort: 8089
              protocol: TCP
            - name: debug
              containerPort: 10254
              protocol: TCP
---
# Source: dataplane/templates/propeller/deployment-webhook.yaml
# Create the actual deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: flytepropeller-webhook
  namespace: union
  labels:
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/component: flyte-pod-webhook
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: release-name-dataplane
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: flyte-pod-webhook
  template:
    metadata:
      labels:
        
        app.kubernetes.io/name: release-name-dataplane
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/component: flyte-pod-webhook
      annotations:
        configChecksum: "b6dc20292f8d2c10db22ee3bfb4033863f93c746e538b24e24b4a529f1e0986"
        
    spec:
      securityContext:
        fsGroup: 65534
        fsGroupChangePolicy: Always
        runAsNonRoot: true
        runAsUser: 1001
        seLinuxOptions:
          type: spc_t
      serviceAccountName: flytepropeller-webhook-system
      initContainers:
        - name: generate-secrets
          image: "public.ecr.aws/p0i0a9q8/unionoperator:2026.1.1"
          imagePullPolicy: "IfNotPresent"
          command:
            - flytepropeller
          args:
            - webhook
            - init-certs
            - --config
            - /etc/flyte/config/*.yaml
          env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: GOMEMLIMIT
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.memory
          - name: GOMAXPROCS
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.cpu
          - name: CLUSTER_NAME
            valueFrom:
              secretKeyRef:
                name: operator-cluster-name
                key: cluster_name
          - name: DEPLOYMENT_NAME
            value: operator
          - name: PROXY_SERVICE_URL
            value: http://union-operator-proxy:8080
          - name: PROMETHEUS_SERVICE_URL
            value: http://union-operator-prometheus:80
          - name: KNATIVE_PROXY_SERVICE_URL
            value: http://kourier-internal
          volumeMounts:
            - name: config-volume
              mountPath: /etc/flyte/config
          resources:
            limits:
              cpu: 1
              ephemeral-storage: 500Mi
              memory: 500Mi
            requests:
              cpu: 200m
              ephemeral-storage: 500Mi
              memory: 500Mi
      containers:
        - name: webhook
          image: "public.ecr.aws/p0i0a9q8/unionoperator:2026.1.1"
          imagePullPolicy: "IfNotPresent"
          command:
            - flytepropeller
          args:
            - webhook
            - --config
            - /etc/flyte/config/*.yaml
          env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: GOMEMLIMIT
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.memory
          - name: GOMAXPROCS
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.cpu
          - name: CLUSTER_NAME
            valueFrom:
              secretKeyRef:
                name: operator-cluster-name
                key: cluster_name
          - name: DEPLOYMENT_NAME
            value: operator
          - name: PROXY_SERVICE_URL
            value: http://union-operator-proxy:8080
          - name: PROMETHEUS_SERVICE_URL
            value: http://union-operator-prometheus:80
          - name: KNATIVE_PROXY_SERVICE_URL
            value: http://kourier-internal
          ports:
            - containerPort: 9443
            - containerPort: 10254
          resources:
            limits:
              cpu: 1
              ephemeral-storage: 500Mi
              memory: 500Mi
            requests:
              cpu: 200m
              ephemeral-storage: 500Mi
              memory: 500Mi
          volumeMounts:
            - name: config-volume
              mountPath: /etc/flyte/config
              readOnly: true
            - name: webhook-certs
              mountPath: /etc/webhook/certs
              readOnly: true
      volumes:
        - name: config-volume
          configMap:
            name: flyte-propeller-config
        - name: webhook-certs
          secret:
            secretName: flyte-pod-webhook
---
# Source: dataplane/templates/propeller/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  namespace: union
  name: flytepropeller
  labels:
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: flytepropeller
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: release-name-dataplane
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: flytepropeller
  template:
    metadata:
      annotations:
        configChecksum: "b6dc20292f8d2c10db22ee3bfb4033863f93c746e538b24e24b4a529f1e0986"
        
      labels:
        
        
        helm.sh/chart: dataplane-2026.1.1
        app.kubernetes.io/name: release-name-dataplane
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/version: "2026.1.1"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: flytepropeller
    spec:
      containers:
        - command:
            - flytepropeller
            - --config
            - /etc/flyte/config/*.yaml
            - --propeller.cluster-id
            - my-cluster
          env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: GOMEMLIMIT
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.memory
          - name: GOMAXPROCS
            valueFrom:
              resourceFieldRef:
                divisor: 1
                resource: limits.cpu
          - name: CLUSTER_NAME
            valueFrom:
              secretKeyRef:
                name: operator-cluster-name
                key: cluster_name
          - name: DEPLOYMENT_NAME
            value: operator
          - name: PROXY_SERVICE_URL
            value: http://union-operator-proxy:8080
          - name: PROMETHEUS_SERVICE_URL
            value: http://union-operator-prometheus:80
          - name: KNATIVE_PROXY_SERVICE_URL
            value: http://kourier-internal
          image: "public.ecr.aws/p0i0a9q8/unionoperator:2026.1.1"
          imagePullPolicy: "IfNotPresent"
          name: flytepropeller
          ports:
            - containerPort: 10254
          resources:
            limits:
              cpu: "3"
              memory: 3Gi
            requests:
              cpu: "1"
              memory: 1Gi
          volumeMounts:
            - name: config-volume
              mountPath: /etc/flyte/config
            - name: auth
              mountPath: /etc/union/secret
      serviceAccountName: flytepropeller-system
      volumes:
        - configMap:
            name: flyte-propeller-config
          name: config-volume
        - name: auth
          secret:
            secretName: union-secret-auth
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/mutatingWebhookConfiguration.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name:  union-operator-admission
  annotations:
    
  labels:
    app: prometheus-admission
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
webhooks:
  - name: prometheusrulemutate.monitoring.coreos.com
    failurePolicy: Ignore
    rules:
      - apiGroups:
          - monitoring.coreos.com
        apiVersions:
          - "*"
        resources:
          - prometheusrules
        operations:
          - CREATE
          - UPDATE
    clientConfig:
      service:
        namespace: union
        name: prometheus-operator
        path: /admission-prometheusrules/mutate
    timeoutSeconds: 10
    admissionReviewVersions: ["v1", "v1beta1"]
    sideEffects: None
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/validatingWebhookConfiguration.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name:  union-operator-admission
  annotations:
    
  labels:
    app: prometheus-admission
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
webhooks:
  - name: prometheusrulevalidate.monitoring.coreos.com
    failurePolicy: Ignore
    rules:
      - apiGroups:
          - monitoring.coreos.com
        apiVersions:
          - "*"
        resources:
          - prometheusrules
        operations:
          - CREATE
          - UPDATE
    clientConfig:
      service:
        namespace: union
        name: prometheus-operator
        path: /admission-prometheusrules/validate
    timeoutSeconds: 10
    admissionReviewVersions: ["v1", "v1beta1"]
    sideEffects: None
  - name: alertmanagerconfigsvalidate.monitoring.coreos.com
    failurePolicy: Ignore
    rules:
      - apiGroups:
          - monitoring.coreos.com
        apiVersions:
          - v1alpha1
        resources:
          - alertmanagerconfigs
        operations:
          - CREATE
          - UPDATE
    clientConfig:
      service:
        namespace: union
        name: prometheus-operator
        path: /admission-alertmanagerconfigs/validate
    timeoutSeconds: 10
    admissionReviewVersions: ["v1", "v1beta1"]
    sideEffects: None
---
# Source: dataplane/charts/prometheus/templates/prometheus/prometheus.yaml
apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: union-operator-prometheus
  namespace: union
  labels:
    app: prometheus-prometheus
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
spec:
  automountServiceAccountToken: true
  image: "quay.io/prometheus/prometheus:v3.8.1"
  imagePullPolicy: "IfNotPresent"
  version: v3.8.1
  externalUrl: http://union-operator-prometheus.union:80
  paused: false
  replicas: 1
  shards: 1
  logLevel:  "info"
  logFormat:  logfmt
  listenLocal: false
  enableOTLPReceiver: false
  enableAdminAPI: false
  resources:
    limits:
      cpu: "3"
      memory: 3500Mi
    requests:
      cpu: "1"
      memory: 1Gi
  retention: "3d"
  tsdb:
    outOfOrderTimeWindow: 0s
  walCompression: true
  routePrefix: "/prometheus/"
  serviceAccountName: union-operator-prometheus
  serviceMonitorSelector:
    matchLabels:
      platform.union.ai/prometheus-group: union-features

  serviceMonitorNamespaceSelector: {}
  podMonitorSelector:
    matchLabels:
      platform.union.ai/prometheus-group: union-features

  podMonitorNamespaceSelector: {}
  probeSelector:
    matchLabels:
      release: "release-name"

  probeNamespaceSelector: {}
  securityContext:
    fsGroup: 2000
    runAsGroup: 2000
    runAsNonRoot: true
    runAsUser: 1000
    seccompProfile:
      type: RuntimeDefault
  ruleNamespaceSelector: {}
  ruleSelector:
    matchLabels:
      platform.union.ai/prometheus-group: union-features
  scrapeConfigSelector:
    matchLabels:
      platform.union.ai/prometheus-group: union-features

  scrapeConfigNamespaceSelector: {}
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          topologyKey: kubernetes.io/hostname
          labelSelector:
            matchExpressions:            
            - {key: app.kubernetes.io/name, operator: In, values: [prometheus]}
            - {key: app.kubernetes.io/instance, operator: In, values: [union-operator-prometheus]}
  portName: http-web
  maximumStartupDurationSeconds: 900
  hostNetwork: false
---
# Source: dataplane/charts/prometheus/charts/kube-state-metrics/templates/servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: release-name-kube-state-metrics
  namespace: union
  labels:    
    helm.sh/chart: kube-state-metrics-7.0.0
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: metrics
    app.kubernetes.io/part-of: kube-state-metrics
    app.kubernetes.io/name: kube-state-metrics
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2.17.0"
    release: release-name
    platform.union.ai/prometheus-group: union-features
spec:
  jobLabel: app.kubernetes.io/name  
  selector:
    matchLabels:      
      app.kubernetes.io/name: kube-state-metrics
      app.kubernetes.io/instance: release-name
  endpoints:
    - port: http
      honorLabels: true
      metricRelabelings:
        - action: keep
          regex: kube_pod_container_resource_(limits|requests)|kube_pod_status_phase|kube_node_(labels|status_allocatable|status_condition|status_capacity)|kube_namespace_labels|kube_pod_container_status_(waiting|terminated|last_terminated).*_reason|kube_daemonset_status_number_unavailable|kube_deployment_status_replicas_unavailable|kube_resourcequota|kube_pod_info|kube_node_info|kube_pod_container_status_restarts_total
          separator: ;
          sourceLabels:
          - __name__
        - action: drop
          regex: kube_pod_status_phase;(Succeeded|Failed)
          separator: ;
          sourceLabels:
          - __name__
          - phase
        - action: replace
          regex: (.*)
          sourceLabels:
          - node
          targetLabel: nodename
        - action: replace
          regex: (.+)
          sourceLabels:
          - label_node_group_name
          targetLabel: label_node_pool_name
---
# Source: dataplane/charts/prometheus/templates/exporters/kubelet/servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: union-operator-kubelet
  namespace: union
  labels:
    app: prometheus-kubelet    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
spec:
  
  attachMetadata:
    node: false
  jobLabel: k8s-app
  namespaceSelector:
    matchNames:
    - kube-system
  selector:
    matchLabels:
      app.kubernetes.io/name: kubelet
      k8s-app: kubelet
  endpoints:
  - port: https-metrics
    scheme: https
    path: /metrics/cadvisor
    interval: 10s
    honorLabels: true
    honorTimestamps: true
    trackTimestampsStaleness: true    
    tlsConfig:
      caFile: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
      insecureSkipVerify: true
    bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token
    metricRelabelings:
    - action: keep
      regex: container_cpu_usage_seconds_total|container_memory_working_set_bytes
      sourceLabels:
      - __name__
    relabelings:
    - action: replace
      sourceLabels:
      - __metrics_path__
      targetLabel: metrics_path
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: prometheus-operator
  namespace: union
  labels:
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app: prometheus-operator
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator
spec:
  
  endpoints:
  - port: https
    scheme: https
    tlsConfig:
      serverName: prometheus-operator
      ca:
        secret:
          name: union-operator-admission
          key: ca
          optional: false
    honorLabels: true
  selector:
    matchLabels:
      app: prometheus-operator
      release: "release-name"
  namespaceSelector:
    matchNames:
      - "union"
---
# Source: dataplane/charts/prometheus/templates/prometheus/servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: union-operator-prometheus
  namespace: union
  labels:
    app: prometheus-prometheus
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
spec:
  
  selector:
    matchLabels:
      app: prometheus-prometheus
      release: "release-name"
      self-monitor: "true"
  namespaceSelector:
    matchNames:
      - "union"
  endpoints:
  - port: http-web
    path: "/prometheus/metrics"
  - port: reloader-web
    path: "/metrics"
---
# Source: dataplane/templates/propeller/servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: release-name-dataplane-flytepropeller
  namespace: union
  labels:
    platform.union.ai/prometheus-group: union-features
    helm.sh/chart: dataplane-2026.1.1
    app.kubernetes.io/name: release-name-dataplane
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "2026.1.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: flytepropeller
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: release-name-dataplane
      app.kubernetes.io/instance: release-name
      app.kubernetes.io/component: flytepropeller
  namespaceSelector:
    matchNames:
      - "union"
  endpoints:
    - port: debug
      path: /metrics
      honorLabels: true
      metricRelabelings:
        - sourceLabels: [__name__]
          separator: ";"
          regex: "flyte:propeller:all:round:execution_info|flyte:propeller:all:node:fast_task:fast_task_execution_duration"
          action: keep
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/job-patch/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name:  union-operator-admission
  namespace: union
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,post-install,post-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
  labels:
    app: prometheus-admission
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
automountServiceAccountToken: true
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/job-patch/clusterrole.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name:  union-operator-admission
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,post-install,post-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
  labels:
    app: prometheus-admission
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
rules:
  - apiGroups:
      - admissionregistration.k8s.io
    resources:
      - validatingwebhookconfigurations
      - mutatingwebhookconfigurations
    verbs:
      - get
      - update
      - patch
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/job-patch/clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name:  union-operator-admission
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,post-install,post-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
  labels:
    app: prometheus-admission
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: union-operator-admission
subjects:
  - kind: ServiceAccount
    name: union-operator-admission
    namespace: union
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/job-patch/role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name:  union-operator-admission
  namespace: union
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,post-install,post-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
  labels:
    app: prometheus-admission
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
rules:
  - apiGroups:
      - ""
    resources:
      - secrets
    verbs:
      - get
      - create
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/job-patch/rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name:  union-operator-admission
  namespace: union
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,post-install,post-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
  labels:
    app: prometheus-admission
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: union-operator-admission
subjects:
  - kind: ServiceAccount
    name: union-operator-admission
    namespace: union
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/job-patch/job-createSecret.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name:  union-operator-admission-create
  namespace: union
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
  labels:
    app: prometheus-admission-create
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
spec:
  ttlSecondsAfterFinished: 60
  template:
    metadata:
      name:  union-operator-admission-create
      labels:
        app: prometheus-admission-create
        
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/version: "80.8.0"
        app.kubernetes.io/part-of: prometheus
        chart: prometheus-80.8.0
        release: "release-name"
        heritage: "Helm"
        platform.union.ai/prometheus-group: union-features
        app.kubernetes.io/name: prometheus-prometheus-operator
        app.kubernetes.io/component: prometheus-operator-webhook
    spec:
      containers:
        - name: create
          image: ghcr.io/jkroepke/kube-webhook-certgen:1.7.3
          imagePullPolicy: IfNotPresent
          args:
            - create
            - --host=prometheus-operator,prometheus-operator.union.svc
            - --namespace=union
            - --secret-name=union-operator-admission
          securityContext:
          
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
          resources:
            {}
      restartPolicy: OnFailure
      serviceAccountName: union-operator-admission
      securityContext:
        runAsGroup: 2000
        runAsNonRoot: true
        runAsUser: 2000
        seccompProfile:
          type: RuntimeDefault
---
# Source: dataplane/charts/prometheus/templates/prometheus-operator/admission-webhooks/job-patch/job-patchWebhook.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name:  union-operator-admission-patch
  namespace: union
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
  labels:
    app: prometheus-admission-patch
    
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/version: "80.8.0"
    app.kubernetes.io/part-of: prometheus
    chart: prometheus-80.8.0
    release: "release-name"
    heritage: "Helm"
    platform.union.ai/prometheus-group: union-features
    app.kubernetes.io/name: prometheus-prometheus-operator
    app.kubernetes.io/component: prometheus-operator-webhook
spec:
  ttlSecondsAfterFinished: 60
  template:
    metadata:
      name:  union-operator-admission-patch
      labels:
        app: prometheus-admission-patch
        
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/instance: release-name
        app.kubernetes.io/version: "80.8.0"
        app.kubernetes.io/part-of: prometheus
        chart: prometheus-80.8.0
        release: "release-name"
        heritage: "Helm"
        platform.union.ai/prometheus-group: union-features
        app.kubernetes.io/name: prometheus-prometheus-operator
        app.kubernetes.io/component: prometheus-operator-webhook
    spec:
      containers:
        - name: patch
          image: ghcr.io/jkroepke/kube-webhook-certgen:1.7.3
          imagePullPolicy: IfNotPresent
          args:
            - patch
            - --webhook-name=union-operator-admission
            - --namespace=union
            - --secret-name=union-operator-admission
            - --patch-failure-policy=
          securityContext:
          
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
          resources:
            {}
      restartPolicy: OnFailure
      serviceAccountName: union-operator-admission
      securityContext:
        runAsGroup: 2000
        runAsNonRoot: true
        runAsUser: 2000
        seccompProfile:
          type: RuntimeDefault
